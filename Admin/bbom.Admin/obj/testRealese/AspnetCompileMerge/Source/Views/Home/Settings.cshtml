@using System.Web.Mvc.Html
@model bbom.Admin.Core.ViewModels.Templates.TemplateSettings
@{
  Layout = "../Shared/_Layout.cshtml";
}
@*<h1>Настройки сайта</h1>
<div class="panel panel-default" style="margin-top: 20px">
    <div class=" panel-heading">Стандартные шаблоны</div>
    <div class="panel-body">
        <div>
            <table id="tableDefault" class="display">
                <thead>
                    <tr>
                        <th style=" border-top: 0px solid #ddd;">ID</th>
                        <th style=" border-top: 0px solid #ddd;">Название</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
<div class="panel panel-default" style="margin-top: 20px">
    <div class=" panel-heading">Персональные шаблоны</div>
    <div class="panel-body">
        <div>
            <table id="tableCreated" class="display">
                <thead>
                <tr>
                    <th style=" border-top: 0px solid #ddd;">ID</th>
                    <th style=" border-top: 0px solid #ddd;">Название</th>
                </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">Ссылка на Ваше видео.</div>
            <div class="panel-body">
                <div>
                    <h3><input id="userVideoLink" value="@Model.userVideoLink" type="text" style="width: 100%"></h3>
                </div>
            </div>
        </div>
    </div>
</div>*@

<h1>Настройки аккаунта</h1>
<div class="panel panel-default" style="margin-top: 20px">
    <div class="panel panel-heading">Ваши контактные данные</div>
    <div class="panel-body">
        @using (Ajax.BeginForm("SaveSettings", "Manage", new AjaxOptions
        {
            Url = Url.Action("SaveSettings", "Manage"),
            OnSuccess = "onNotify",
            HttpMethod = "POST",
            InsertionMode = InsertionMode.Replace,
            AllowCache = true
        }))
        {
            @Html.AntiForgeryToken()
            <label>Электронная почта: </label>
            @Model.Email
            <br/>
            //
            @Html.LabelFor(m => m.Name)
            @Html.TextBoxFor(m => m.Name, new {@class = "form-control"})
            //
            @Html.LabelFor(m => m.Suname)
            @Html.TextBoxFor(m => m.Suname, new {@class = "form-control"})
            //
            @Html.LabelFor(m => m.Altname)
            @Html.TextBoxFor(m => m.Altname, new {@class = "form-control"})
            //
            @Html.LabelFor(m => m.PhoneNumber)
            @Html.TextBoxFor(m => m.PhoneNumber, new {@class = "form-control"})
            <br/>
            <button type="submit" class="btn btn-primary btn-sm">Сохранить</button>
        }
    </div>
</div>
<div class="panel panel-default" style="margin-top: 20px">
    <div class="panel panel-heading">Средства связи</div>
    <div class="panel-body">
        <table id="communicationsTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th style="border-top: 0px solid #ddd;">
                    id
                </th>
                <th style="border-top: 0px solid #ddd;">
                    Средство связи
                </th>
                <th style="border-top: 0px solid #ddd;">
                    Значение
                </th>
            </tr>
            </thead>
        </table>
    </div>
</div>
<div class="panel panel-default" style="margin-top: 20px">
    <div class="panel panel-heading">Безопасность</div>
    <div class="panel-body">
        <div>
            <a href="@Url.Action("ChangePassword", "Manage")">Сменить пароль</a>
        </div>
    </div>
</div>

<!-- modalAddCommunication -->
<div class="modal fade" id="modalAddCommunication" tabindex="-1" role="dialog" aria-labelledby="modalAddCommunicationLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 900px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="modalAddCommunicationLabel">Добавить средство связи</h4>
            </div>
            <div class="modal-body" style="padding-left: 20px">
                <form>
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <div class="form-group">
                        @Html.LabelFor(m => m.CommunicationId, new { style = "display: block" })
                        <div class="col-md-10">
                            @Html.DropDownListFor(m => m.CommunicationId, (IEnumerable<SelectListItem>)ViewBag.Communications)
                        </div>
                    </div><br />
                    <div class="form-group">
                        @Html.LabelFor(model => model.Value, new { style = "display: block" })
                        @Html.EditorFor(model => model.Value, new { htmlAttributes = new { @class = "form-control", id = "model_value" } })
                        @Html.ValidationMessageFor(model => model.Value, "", new { @class = "text-danger" })
                    </div>
                    <input id="modal_button_submit" type="button" value="Добавить" class="btn btn-default"/>
                </form>
            </div>
        </div>
    </div>
</div>


@section Scripts{
    <script src="../../Scripts/Views/Home/SettingsView.js"></script>
    <script>
        var GetCommunicationsArray = '@Url.Action("GetCommunicationsArray", "Communication")';
        var AddCommunication = '@Url.Action("Add", "Communication")';
        var EditCommunication = '@Url.Action("Edit", "Communication")';
        var GetUserNotAddedCommunications = '@Url.Action("GetUserNotAddedCommunications", "Communication")';
        var GetAllCommunications = '@Url.Action("GetAllCommunications", "Communication")';
        var selectedTemplateId = '@Model.templateId';

        $(function () {
            var settingsView = new SettingsView();
            @*$.ajax({
                type: "GET",
                url: "@Url.Action("GetTemplates", "Templates")",
                success: function(json) {
                    var tableDefault = $('#tableDefault').DataTable({
                        data: json.defaults,
                        searching: false,
                        "paging": false,
                        "ordering": false,
                        "info": false,
                        dom: 'Bfrtip',
                        select: true
                    });
                    var tableCreated = $('#tableCreated').DataTable({
                        "paging": false,
                        "ordering": false,
                        "info": false,
                        searching: false,
                        data: json.created,
                        dom: 'Bfrtip',
                        select: true
                    });

                    selectActive(tableDefault);
                    selectActive(tableCreated);

                    tableDefault.on('select', select);
                    tableCreated.on('select', select);


                }
            });*@
        });

        @*function save() {
            var userVideoLink = $("#userVideoLink").val();
            $.post("@Url.Action("SaveActiveTemplate", "Templates")", {
                templateId: selectedTemplateId,
                userVideoLink: userVideoLink
            }, function (data) {
                window.notify(data);
            });
        }

        function selectActive(table) {
            for (var i = 0; i < table.rows().data().length; i++) {
                if (table.row(i).data()[0] === selectedTemplateId) {
                    table.row(i).select();
                }
            }
        }

        function select(e, dt, type, indexes) {
            if (indexes.length === 1)
                selectedTemplateId = indexes[0].toString();
        }*@

        function onNotify(json) {
            window.notify(json);
        }

    </script>
}
